<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Double Slit Experiment Simulator</title>
<style>
    body {
        font-family: Arial, sans-serif;
        text-align: center;
    }
    #controls {
        margin-bottom: 20px;
    }
    .control-group {
        margin: 10px 0;
    }
    label {
        display: inline-block;
        width: 150px;
        text-align: right;
    }
    input[type="range"] {
        width: 300px;
    }
    #simulationCanvas {
        border: 1px solid #ccc;
        margin-top: 20px;
        background-color: #f0f0f0;
    }
    #legend {
        text-align: left;
        margin-top: 10px;
        font-size: 14px;
    }
    .legend-item {
        margin: 5px 0;
    }
    .color-box {
        display: inline-block;
        width: 15px;
        height: 15px;
        vertical-align: middle;
        margin-right: 5px;
    }
</style>
</head>
<body>

<h1>Double Slit Experiment Simulator</h1>

<div id="controls">
    <div class="control-group">
        <label for="wavelength">Wavelength (nm):</label>
        <input type="range" id="wavelength" min="380" max="750" value="550">
        <span id="wavelengthValue">550</span>
    </div>

    <div class="control-group">
        <label for="slitSeparation">Slit Separation (μm):</label>
        <input type="range" id="slitSeparation" min="10" max="100" value="50">
        <span id="slitSeparationValue">500</span>
    </div>
    <div class="control-group">
        <label for="screenDistance">Screen Distance (m):</label>
        <input type="range" id="screenDistance" min="1" max="10" value="5">
        <span id="screenDistanceValue">5</span>
    </div>
</div>

<canvas id="simulationCanvas" width="900" height="400"></canvas>

<script>
// Canvas setup
const canvas = document.getElementById('simulationCanvas');
const ctx = canvas.getContext('2d');

// DOM elements
const wavelengthSlider = document.getElementById('wavelength');
const slitSeparationSlider = document.getElementById('slitSeparation');
const screenDistanceSlider = document.getElementById('screenDistance');

const wavelengthValue = document.getElementById('wavelengthValue');
const slitWidthValue = 5 * 1e-6;
const slitSeparationValue = document.getElementById('slitSeparationValue');
const screenDistanceValue = document.getElementById('screenDistanceValue');

// Variables to store positions
let laserX, scaleX, totalDistance, screenX, slitsX;

// Update displayed values and simulation
function updateSimulation() {
    // Update the displayed values
    wavelengthValue.textContent = wavelengthSlider.value;
    slitSeparationValue.textContent = slitSeparationSlider.value;
    screenDistanceValue.textContent = screenDistanceSlider.value;

    // Get parameters
    const wavelength = parseFloat(wavelengthSlider.value) * 1e-9; // Convert nm to meters
    const slitWidth = 5 * 1e-6;   // Convert μm to meters
    const slitSeparation = parseFloat(slitSeparationSlider.value) * 1e-6; // Convert μm to meters
    const screenDistance = parseFloat(screenDistanceSlider.value); // In meters

    // Clear canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw the experiment setup
    drawSetup(slitSeparation, screenDistance);

    // Simulation parameters
    const numPoints = 500; // Number of points on the screen to calculate intensity
    const maxIntensity = 1;

    // Draw intensity pattern as histogram extending from the screen to the right
    for (let i = 0; i < numPoints; i++) {
        // Position on the screen (from -height/2 to height/2)
        const y = i - numPoints / 2;
        // Calculate angle theta
        const theta = Math.atan(y * 1e-3 / screenDistance); // Scale y to meters

        // Calculate beta and gamma
        const beta = (Math.PI * slitWidth * Math.sin(theta)) / wavelength;
        const gamma = (Math.PI * slitSeparation * Math.sin(theta)) / wavelength;

        // Calculate intensity
        let intensity = Math.pow(Math.cos(gamma), 2) * Math.pow(Math.sin(beta) / beta, 2);

        // Handle division by zero
        if (isNaN(intensity)) intensity = maxIntensity;

        // Normalize intensity
        intensity = intensity / maxIntensity;

        // Set color based on wavelength
        const color = wavelengthToColor(wavelengthSlider.value, intensity);

        // Draw the intensity bar extending from the screen
        ctx.fillStyle = color;
        const barLength = intensity * 100; // Length of the bar proportional to intensity
        ctx.fillRect(screenX + 10, canvas.height / 2 + y, barLength, 1);
    }
}

// Function to draw the experimental setup
function drawSetup(slitSeparation, screenDistance) {
    // Fixed positions
    const screenXFixed = canvas.width - 150; // Fixed position for the screen
    const laserXFixed = 50; // Fixed position for the laser
    const laserY = canvas.height / 2;

    // Scaling factor
    const maxScreenDistance = 10; // Maximum screen distance from slider
    const maxTotalDistance = maxScreenDistance; // The maximum distance between slits and screen
    const availableCanvasWidth = screenXFixed - laserXFixed - 50; // Subtracting margins
    scaleX = availableCanvasWidth / maxTotalDistance;

    // Positions
    screenX = screenXFixed;
    slitsX = screenX - screenDistance * scaleX; // Slits move based on screen distance
    const laserX = laserXFixed;
    const laserToSlitDistance = 1; // Fixed at 1 meter

    // Adjust laser position if necessary
    const minLaserX = 20;
    if (slitsX - laserToSlitDistance * scaleX < minLaserX) {
        // Move laser to the left to maintain the fixed laser to slit distance
        laserX = slitsX - laserToSlitDistance * scaleX;
    }

    // Draw laser
    ctx.fillStyle = 'grey';
    ctx.fillRect(laserX - 100, laserY - 100, 100, 200);

    // Draw laser beam
    ctx.strokeStyle = 'red';
    ctx.lineWidth = 50;
    ctx.beginPath();
    ctx.moveTo(laserX, laserY);
    ctx.lineTo(slitsX, laserY);
    ctx.stroke();

    // Draw slits
    ctx.fillStyle = 'black';
    const slitWidthVisual = 5;
    const slitSeparationVisual = slitSeparation * 1e6 * 0.5; // Scaled for visualization


    ctx.fillRect(slitsX - slitWidthVisual / 2, laserY - 50, slitWidthVisual, 100);

    // Upper slit
    ctx.fillStyle = '#f0f0f0';
    ctx.fillRect(slitsX - slitWidthVisual / 2, laserY - slitSeparationVisual / 2 - 1, slitWidthVisual, 2);
    // Lower slit
    ctx.fillRect(slitsX - slitWidthVisual / 2, laserY + slitSeparationVisual / 2 - 1, slitWidthVisual, 2);


    // Draw screen
    ctx.fillStyle = 'grey';
    ctx.fillRect(screenX, 0, 10, canvas.height);

    // Draw beams from slits to screen (simplified representation)
    ctx.strokeStyle = 'rgba(0, 0, 255, 0.3)';
    ctx.lineWidth = 1;

    // // From upper slit
    // ctx.beginPath();
    // ctx.moveTo(slitsX, laserY - slitSeparationVisual / 2);
    // ctx.lineTo(screenX, laserY - slitSeparationVisual / 2);
    // ctx.stroke();

    // // From lower slit
    // ctx.beginPath();
    // ctx.moveTo(slitsX, laserY + slitSeparationVisual / 2);
    // ctx.lineTo(screenX, laserY + slitSeparationVisual / 2);
    // ctx.stroke();
}

// Convert wavelength to RGB color
function wavelengthToColor(wavelength, intensity) {
    let R, G, B, alpha;
    const gamma = 0.8;
    const maxIntensity = 255;

    if (wavelength >= 380 && wavelength < 440) {
        R = -(wavelength - 440) / (440 - 380);
        G = 0.0;
        B = 1.0;
    } else if (wavelength >= 440 && wavelength < 490) {
        R = 0.0;
        G = (wavelength - 440) / (490 - 440);
        B = 1.0;
    } else if (wavelength >= 490 && wavelength < 510) {
        R = 0.0;
        G = 1.0;
        B = -(wavelength - 510) / (510 - 490);
    } else if (wavelength >= 510 && wavelength < 580) {
        R = (wavelength - 510) / (580 - 510);
        G = 1.0;
        B = 0.0;
    } else if (wavelength >= 580 && wavelength < 645) {
        R = 1.0;
        G = -(wavelength - 645) / (645 - 580);
        B = 0.0;
    } else if (wavelength >= 645 && wavelength <= 750) {
        R = 1.0;
        G = 0.0;
        B = 0.0;
    } else {
        R = G = B = 0.0;
    }

    // Let the intensity fall off near the vision limits
    if (wavelength >= 380 && wavelength < 420) {
        alpha = 0.3 + 0.7 * (wavelength - 380) / (420 - 380);
    } else if (wavelength >= 420 && wavelength <= 700) {
        alpha = 1.0;
    } else if (wavelength > 700 && wavelength <= 750) {
        alpha = 0.3 + 0.7 * (750 - wavelength) / (750 - 700);
    } else {
        alpha = 0.0;
    }

    R = Math.round(maxIntensity * Math.pow(R * intensity * alpha, gamma));
    G = Math.round(maxIntensity * Math.pow(G * intensity * alpha, gamma));
    B = Math.round(maxIntensity * Math.pow(B * intensity * alpha, gamma));

    return `rgb(${R}, ${G}, ${B})`;
}

// Add event listeners
[wavelengthSlider, slitSeparationSlider, screenDistanceSlider].forEach(slider => {
    slider.addEventListener('input', updateSimulation);
});

// Initial simulation
updateSimulation();
</script>

</body>
</html>
